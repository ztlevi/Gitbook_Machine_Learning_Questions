
<!DOCTYPE HTML>
<html lang>
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>PSPNet &#xB7; GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content>
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-custom-js-css/9eb07385451571ed1c43d6bfc772c8d5-docsearch.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-docsearch/doc-search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../facenet.html">
    
    
    <link rel="prev" href="panoptic.html">
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary"><div id="book-search-input">
    <input type="text" id="book-doc-search-input" placeholder="Type to search">
</div>
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../basics/">
            
                <a href="../../basics/">
            
                    
                    Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../basics/optimization.html">
            
                <a href="../../basics/optimization.html">
            
                    
                    Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../basics/how_to_prevent_overfitting.html">
            
                <a href="../../basics/how_to_prevent_overfitting.html">
            
                    
                    How to prevent overfitting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../basics/linear_algebra.html">
            
                <a href="../../basics/linear_algebra.html">
            
                    
                    Linear Algebra
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../basics/clustering.html">
            
                <a href="../../basics/clustering.html">
            
                    
                    Clustering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../basics/calculate_parameters_in_cnn.html">
            
                <a href="../../basics/calculate_parameters_in_cnn.html">
            
                    
                    Calculate Parameters in CNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../basics/weight_norm_and_layer_norm.html">
            
                <a href="../../basics/weight_norm_and_layer_norm.html">
            
                    
                    Weight norm and layer norm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../basics/Confidence_Interval.html">
            
                <a href="../../basics/Confidence_Interval.html">
            
                    
                    Confidence Interval
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../../basics/Quantization.html">
            
                <a href="../../basics/Quantization.html">
            
                    
                    Quantization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../classical_ml/">
            
                <a href="../../classical_ml/">
            
                    
                    Classical Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../neural_networks/">
            
                <a href="../../neural_networks/">
            
                    
                    Neural Networks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../neural_networks/different_types_of_convolution.html">
            
                <a href="../../neural_networks/different_types_of_convolution.html">
            
                    
                    Different Types of Convolution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../neural_networks/loss/">
            
                <a href="../../neural_networks/loss/">
            
                    
                    Loss
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../neural_networks/loss/Hinge_Loss.html">
            
                <a href="../../neural_networks/loss/Hinge_Loss.html">
            
                    
                    Hinge Loss
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../../neural_networks/loss/cross_entropy_loss.html">
            
                <a href="../../neural_networks/loss/cross_entropy_loss.html">
            
                    
                    Cross-Entropy Loss
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../../neural_networks/loss/binary_cross_entropy_loss.html">
            
                <a href="../../neural_networks/loss/binary_cross_entropy_loss.html">
            
                    
                    Binary Cross-Entropy Loss
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="../../neural_networks/loss/categorical_cross_entropy_loss.html">
            
                <a href="../../neural_networks/loss/categorical_cross_entropy_loss.html">
            
                    
                    Categorical Cross-Entropy Loss
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="../../neural_networks/loss/focal_loss.html">
            
                <a href="../../neural_networks/loss/focal_loss.html">
            
                    
                    Optional: Focal Loss
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="../../neural_networks/loss/coral_loss.html">
            
                <a href="../../neural_networks/loss/coral_loss.html">
            
                    
                    Optional: CORAL Loss
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../neural_networks/resnet.html">
            
                <a href="../../neural_networks/resnet.html">
            
                    
                    Resnet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../neural_networks/mobilenet.html">
            
                <a href="../../neural_networks/mobilenet.html">
            
                    
                    Mobilenet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../">
            
                <a href="../">
            
                    
                    Computer Vision
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../two-stage-detector/">
            
                <a href="../two-stage-detector/">
            
                    
                    Two Stage Object Detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../two-stage-detector/metrics.html">
            
                <a href="../two-stage-detector/metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../two-stage-detector/roi.html">
            
                <a href="../two-stage-detector/roi.html">
            
                    
                    ROI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../two-stage-detector/r-cnn.html">
            
                <a href="../two-stage-detector/r-cnn.html">
            
                    
                    R-CNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../two-stage-detector/fast-rcnn.html">
            
                <a href="../two-stage-detector/fast-rcnn.html">
            
                    
                    Fast RCNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="../two-stage-detector/faster-rcnn.html">
            
                <a href="../two-stage-detector/faster-rcnn.html">
            
                    
                    Faster RCNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.6" data-path="../two-stage-detector/mask-rcnn.html">
            
                <a href="../two-stage-detector/mask-rcnn.html">
            
                    
                    Mask RCNN
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../one-stage-detector/">
            
                <a href="../one-stage-detector/">
            
                    
                    One Stage Object Detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../one-stage-detector/yolo.html">
            
                <a href="../one-stage-detector/yolo.html">
            
                    
                    YOLO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../one-stage-detector/ssd.html">
            
                <a href="../one-stage-detector/ssd.html">
            
                    
                    Single Shot MultiBox Detector(SSD)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../one-stage-detector/fpn.html">
            
                <a href="../one-stage-detector/fpn.html">
            
                    
                    FPN
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="./">
            
                <a href="./">
            
                    
                    Segmentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="panoptic.html">
            
                <a href="panoptic.html">
            
                    
                    Panoptic Segmentation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3.2" data-path="PSPNet.html">
            
                <a href="PSPNet.html">
            
                    
                    PSPNet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../facenet.html">
            
                <a href="../facenet.html">
            
                    
                    FaceNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../gan.html">
            
                <a href="../gan.html">
            
                    
                    GAN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../Object_detection_imbalance.html">
            
                <a href="../Object_detection_imbalance.html">
            
                    
                    Imbalance problem in object detection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../nlp/">
            
                <a href="../../nlp/">
            
                    
                    NLP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../nlp/embedding.html">
            
                <a href="../../nlp/embedding.html">
            
                    
                    Embedding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../nlp/rnn.html">
            
                <a href="../../nlp/rnn.html">
            
                    
                    RNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../nlp/lstm.html">
            
                <a href="../../nlp/lstm.html">
            
                    
                    LSTM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../parallel-computeing/">
            
                <a href="../../parallel-computeing/">
            
                    
                    Parallel Computeing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../parallel-computeing/communication.html">
            
                <a href="../../parallel-computeing/communication.html">
            
                    
                    Communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../parallel-computeing/sync_mapreduce.html">
            
                <a href="../../parallel-computeing/sync_mapreduce.html">
            
                    
                    MapReduce
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../parallel-computeing/parameter_server.html">
            
                <a href="../../parallel-computeing/parameter_server.html">
            
                    
                    Parameter Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../parallel-computeing/decentralized_and_ring_allreduce.html">
            
                <a href="../../parallel-computeing/decentralized_and_ring_allreduce.html">
            
                    
                    Decentralized And Ring All Reduce
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../parallel-computeing/federated_learning.html">
            
                <a href="../../parallel-computeing/federated_learning.html">
            
                    
                    Federated Learning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../anomaly-detection/">
            
                <a href="../../anomaly-detection/">
            
                    
                    Anomaly Detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../anomaly-detection/dbscan.html">
            
                <a href="../../anomaly-detection/dbscan.html">
            
                    
                    DBSCAN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../anomaly-detection/autoencoder_anomaly.html">
            
                <a href="../../anomaly-detection/autoencoder_anomaly.html">
            
                    
                    Autoencoder
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../visualization/">
            
                <a href="../../visualization/">
            
                    
                    Visualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../visualization/saliency_maps.html">
            
                <a href="../../visualization/saliency_maps.html">
            
                    
                    Saliency Maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../visualization/fooling_images.html">
            
                <a href="../../visualization/fooling_images.html">
            
                    
                    Fooling images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../../visualization/class_visualization.html">
            
                <a href="../../visualization/class_visualization.html">
            
                    
                    Class Visualization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../..">PSPNet</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <p>For Image scene semantic segmentation PSPNet performs better than other semantic segmentation nets like FCN,U-Net,Deeplab.</p>
<p>In this article,we&#x2019;ll discuss about PSPNet and implementation in Keras.</p>
<h2 id="pyramid-scene-parsing-network-pspnet">Pyramid Scene Parsing Network (PSPNet)</h2>
<figure>
<img src="https://miro.medium.com/max/2869/1*emYC4xYASMLb5bSHNLZHOg.png" alt style="width:100%;display:block;margin-left:auto;margin-right:auto;">
<figcaption style="text-align:center"></figcaption>
</figure>

<h2 id="a-input-image">a) Input Image</h2>
<p>Input image of any shape usually dimensions greater than (256, 256) feed to the network.</p>
<h2 id="b-feature-map">b) Feature Map</h2>
<p>Takes input image and constructs feature maps for image. Feature maps are extracted by feeding image using transfer learning or scratch network with dilated convolutions. As large size kernels extracts more useful information than small size kernel but computation cost is higher, dilated convolutions gathers large size area information with small size kernel for higher <strong>dilation_rates</strong> to <strong>keep dimensions same</strong> as <strong>input Image</strong>.Generally <strong>residual blocks</strong> with <strong>dilations</strong> are used to construct feature maps.No.of feature maps <strong>N</strong> is a hyperparameter and needs to be tuned for good result.</p>
<h2 id="c-pyramid-pooling-module">c) Pyramid Pooling Module</h2>
<p>An Image contains objects of sizes ranging from small area to large area in different regions.Fully Convolution Network(FCN),U-Net and other networks constructs feature maps by upsampling and doing segmentation at different levels for segmentation of all objects in all regions.But in PSPNet to correctly segment all size objects, feature maps are pooled average pooled at different pool size.</p>
<p>Sub-region average pooling is done at different scales like <strong>Global Average Pooling**</strong>,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>2</mn><mo>&#x2217;</mo><mn>2</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>3</mn><mo>&#x2217;</mo><mn>3</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>4</mn><mo>&#x2217;</mo><mn>4</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>6</mn><mo>&#x2217;</mo><mn>6</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>8</mn><mo>&#x2217;</mo><mn>8</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(2*2),(3*3),(4*4),(6*6),(8*8)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mbin">&#x2217;</span><span class="mord mathrm">2</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">3</span><span class="mbin">&#x2217;</span><span class="mord mathrm">3</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">4</span><span class="mbin">&#x2217;</span><span class="mord mathrm">4</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">6</span><span class="mbin">&#x2217;</span><span class="mord mathrm">6</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">8</span><span class="mbin">&#x2217;</span><span class="mord mathrm">8</span><span class="mclose">)</span></span></span></span>..<br>After average pooling of <strong>N</strong> feature maps with <strong>n</strong> different sizes, feature maps at each level reduced to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">N/n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathrm">/</span><span class="mord mathit">n</span></span></span></span> feature maps by performing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>&#x2217;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1*1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mbin">&#x2217;</span><span class="mord mathrm">1</span></span></span></span> convolutions.</p>
<p>For instance, if N=512 feature maps and n=4 sizes like Global Average Pooling,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>2</mn><mo>&#x2217;</mo><mn>2</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>4</mn><mo>&#x2217;</mo><mn>4</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>8</mn><mo>&#x2217;</mo><mn>8</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(2*2),(4*4),(8*8)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mbin">&#x2217;</span><span class="mord mathrm">2</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">4</span><span class="mbin">&#x2217;</span><span class="mord mathrm">4</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mopen">(</span><span class="mord mathrm">8</span><span class="mbin">&#x2217;</span><span class="mord mathrm">8</span><span class="mclose">)</span></span></span></span> then at each level 512 feature maps are reduced to 126 feature maps.</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">N/n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathrm">/</span><span class="mord mathit">n</span></span></span></span> feature maps at each level <strong>upsampled</strong> to have the <strong>same dimensions of input Image.</strong> For upsampling , bilinear_interpolation or convolution_transpose methods used instead simple upsampling.</p>
<p>Output of Pyramid Pooling Module is <strong>concatenation</strong> of base feature maps from <strong>b</strong> and upsampled average pooled feature maps from <strong>c</strong>.</p>
<h2 id="d-final-prediction">d) Final Prediction</h2>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>&#x2217;</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">2*N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span><span class="mbin">&#x2217;</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> feature maps are feed to convolution layer and final prediction of classes are generated on how output layer is constructed say different channels for different objects or single channel.</p>
<h1 id="implementation-in-kerastensorflow">Implementation in Keras/Tensorflow</h1>
<p>Dataset we are applying semantic segmentation in PSPNet is on Kaggle&#x2019;s <a href="https://www.kaggle.com/dansbecker/cityscapes-image-pairs" target="_blank">Cityscapes Image Pairs</a> dataset of size 106 Mb.</p>
<h2 id="dataset">Dataset</h2>
<p>Dataset contains two folders Training images (train) folder and Validation images (val) folder.In each folder each image is of shape <strong>(512, 256, 3 )</strong> and <strong>width=512, height=256, channels=3</strong>. Where each image contains original image without segmentation and segmented image. Separate normal image into <strong>train_imgs, valid_imgs</strong> and segmented image into arrays <strong>train_masks, valid_masks</strong>.</p>
<pre><code class="lang-python">train_folder=<span class="hljs-string">&quot;/kaggle/input/cityscapes-image-pairs/cityscapes_data/cityscapes_data/train/&quot;</span>
valid_folder=<span class="hljs-string">&quot;/kaggle/input/cityscapes-image-pairs/cityscapes_data/cityscapes_data/val/&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_images_masks</span><span class="hljs-params">(path)</span>:</span>
    names=os.listdir(path)
    img_g,img_m=[],[]
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> names:
        img=cv2.imread(path+name)
        img=cv2.normalize(img,<span class="hljs-keyword">None</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,cv2.NORM_MINMAX,cv2.CV_32F)
        img=img[:,:,::<span class="hljs-number">-1</span>]
        img_g.append(img[:,:<span class="hljs-number">256</span>])
        img_m.append(np.reshape(img[:,<span class="hljs-number">256</span>:],(<span class="hljs-number">256</span>*<span class="hljs-number">256</span>*<span class="hljs-number">3</span>)))
        <span class="hljs-keyword">del</span> img
    <span class="hljs-keyword">del</span> names
    <span class="hljs-keyword">return</span> img_g,img_m

train_imgs,train_masks=get_images_masks(train_folder)
valid_imgs,valid_masks=get_images_masks(valid_folder)
</code></pre>
<h2 id="network-architecture">Network Architecture</h2>
<p>A simple PSPNet architecture with following parameters,</p>
<p><strong>Module b</strong> constructed with 3 layers of Residual blocks with Dilation Convolutions outputs <strong>256 feature maps</strong>.</p>
<p><strong>Module C</strong> defined with <strong>pool_sizes GlobalAveragePooling, (2<em>2), (4</em>4), (8*8)</strong> and for <strong>Upsampling, bilinear_interpolation</strong> used. Each <strong>256 pooled feature maps</strong> are reduced to <strong>64 feature maps</strong> combining <strong>512 feature maps total</strong>.</p>
<p><strong>Module D</strong> is simply a convolution layer of 512 feature maps output <strong>(256,256,3) dimensional feature maps</strong> which are <strong>flattened</strong> into a single array of size (256<em>256</em>3).</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">conv_block</span><span class="hljs-params">(X,filters,block)</span>:</span>
    <span class="hljs-comment"># resiudal block with dilated convolutions</span>
    <span class="hljs-comment"># add skip connection at last after doing convoluion operation to input X</span>

    b = <span class="hljs-string">&apos;block_&apos;</span>+str(block)+<span class="hljs-string">&apos;_&apos;</span>
    f1,f2,f3 = filters
    X_skip = X
    <span class="hljs-comment"># block_a</span>
    X = Convolution2D(filters=f1,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),dilation_rate=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),
                      padding=<span class="hljs-string">&apos;same&apos;</span>,kernel_initializer=<span class="hljs-string">&apos;he_normal&apos;</span>,name=b+<span class="hljs-string">&apos;a&apos;</span>)(X)
    X = BatchNormalization(name=b+<span class="hljs-string">&apos;batch_norm_a&apos;</span>)(X)
    X = LeakyReLU(alpha=<span class="hljs-number">0.2</span>,name=b+<span class="hljs-string">&apos;leakyrelu_a&apos;</span>)(X)
    <span class="hljs-comment"># block_b</span>
    X = Convolution2D(filters=f2,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),dilation_rate=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),
                      padding=<span class="hljs-string">&apos;same&apos;</span>,kernel_initializer=<span class="hljs-string">&apos;he_normal&apos;</span>,name=b+<span class="hljs-string">&apos;b&apos;</span>)(X)
    X = BatchNormalization(name=b+<span class="hljs-string">&apos;batch_norm_b&apos;</span>)(X)
    X = LeakyReLU(alpha=<span class="hljs-number">0.2</span>,name=b+<span class="hljs-string">&apos;leakyrelu_b&apos;</span>)(X)
    <span class="hljs-comment"># block_c</span>
    X = Convolution2D(filters=f3,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),dilation_rate=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),
                      padding=<span class="hljs-string">&apos;same&apos;</span>,kernel_initializer=<span class="hljs-string">&apos;he_normal&apos;</span>,name=b+<span class="hljs-string">&apos;c&apos;</span>)(X)
    X = BatchNormalization(name=b+<span class="hljs-string">&apos;batch_norm_c&apos;</span>)(X)
    <span class="hljs-comment"># skip_conv</span>
    X_skip = Convolution2D(filters=f3,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),padding=<span class="hljs-string">&apos;same&apos;</span>,name=b+<span class="hljs-string">&apos;skip_conv&apos;</span>)(X_skip)
    X_skip = BatchNormalization(name=b+<span class="hljs-string">&apos;batch_norm_skip_conv&apos;</span>)(X_skip)
    <span class="hljs-comment"># block_c + skip_conv</span>
    X = Add(name=b+<span class="hljs-string">&apos;add&apos;</span>)([X,X_skip])
    X = ReLU(name=b+<span class="hljs-string">&apos;relu&apos;</span>)(X)
    <span class="hljs-keyword">return</span> X

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">base_feature_maps</span><span class="hljs-params">(input_layer)</span>:</span>
    <span class="hljs-comment"># base covolution module to get input image feature maps</span>

    <span class="hljs-comment"># block_1</span>
    base = conv_block(input_layer,[<span class="hljs-number">32</span>,<span class="hljs-number">32</span>,<span class="hljs-number">64</span>],<span class="hljs-string">&apos;1&apos;</span>)
    <span class="hljs-comment"># block_2</span>
    base = conv_block(base,[<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">128</span>],<span class="hljs-string">&apos;2&apos;</span>)
    <span class="hljs-comment"># block_3</span>
    base = conv_block(base,[<span class="hljs-number">128</span>,<span class="hljs-number">128</span>,<span class="hljs-number">256</span>],<span class="hljs-string">&apos;3&apos;</span>)
    <span class="hljs-keyword">return</span> base

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pyramid_feature_maps</span><span class="hljs-params">(input_layer)</span>:</span>
    <span class="hljs-comment"># pyramid pooling module</span>

    base = base_feature_maps(input_layer)
    <span class="hljs-comment"># red</span>
    red = GlobalAveragePooling2D(name=<span class="hljs-string">&apos;red_pool&apos;</span>)(base)
    red = tf.keras.layers.Reshape((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">256</span>))(red)
    red = Convolution2D(filters=<span class="hljs-number">64</span>,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),name=<span class="hljs-string">&apos;red_1_by_1&apos;</span>)(red)
    red = UpSampling2D(size=<span class="hljs-number">256</span>,interpolation=<span class="hljs-string">&apos;bilinear&apos;</span>,name=<span class="hljs-string">&apos;red_upsampling&apos;</span>)(red)
    <span class="hljs-comment"># yellow</span>
    yellow = AveragePooling2D(pool_size=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),name=<span class="hljs-string">&apos;yellow_pool&apos;</span>)(base)
    yellow = Convolution2D(filters=<span class="hljs-number">64</span>,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),name=<span class="hljs-string">&apos;yellow_1_by_1&apos;</span>)(yellow)
    yellow = UpSampling2D(size=<span class="hljs-number">2</span>,interpolation=<span class="hljs-string">&apos;bilinear&apos;</span>,name=<span class="hljs-string">&apos;yellow_upsampling&apos;</span>)(yellow)
    <span class="hljs-comment"># blue</span>
    blue = AveragePooling2D(pool_size=(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>),name=<span class="hljs-string">&apos;blue_pool&apos;</span>)(base)
    blue = Convolution2D(filters=<span class="hljs-number">64</span>,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),name=<span class="hljs-string">&apos;blue_1_by_1&apos;</span>)(blue)
    blue = UpSampling2D(size=<span class="hljs-number">4</span>,interpolation=<span class="hljs-string">&apos;bilinear&apos;</span>,name=<span class="hljs-string">&apos;blue_upsampling&apos;</span>)(blue)
    <span class="hljs-comment"># green</span>
    green = AveragePooling2D(pool_size=(<span class="hljs-number">8</span>,<span class="hljs-number">8</span>),name=<span class="hljs-string">&apos;green_pool&apos;</span>)(base)
    green = Convolution2D(filters=<span class="hljs-number">64</span>,kernel_size=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),name=<span class="hljs-string">&apos;green_1_by_1&apos;</span>)(green)
    green = UpSampling2D(size=<span class="hljs-number">8</span>,interpolation=<span class="hljs-string">&apos;bilinear&apos;</span>,name=<span class="hljs-string">&apos;green_upsampling&apos;</span>)(green)
    <span class="hljs-comment"># base + red + yellow + blue + green</span>
    <span class="hljs-keyword">return</span> tf.keras.layers.concatenate([base,red,yellow,blue,green])

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">last_conv_module</span><span class="hljs-params">(input_layer)</span>:</span>
    X = pyramid_feature_maps(input_layer)
    X = Convolution2D(filters=<span class="hljs-number">3</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&apos;same&apos;</span>,name=<span class="hljs-string">&apos;last_conv_3_by_3&apos;</span>)(X)
    X = BatchNormalization(name=<span class="hljs-string">&apos;last_conv_3_by_3_batch_norm&apos;</span>)(X)
    X = Activation(<span class="hljs-string">&apos;sigmoid&apos;</span>,name=<span class="hljs-string">&apos;last_conv_relu&apos;</span>)(X)
    X = tf.keras.layers.Flatten(name=<span class="hljs-string">&apos;last_conv_flatten&apos;</span>)(X)
    <span class="hljs-keyword">return</span> X
</code></pre>
<h2 id="reference">Reference</h2>
<p><a href="https://medium.com/analytics-vidhya/semantic-segmentation-in-pspnet-with-implementation-in-keras-4843d05fc025" target="_blank">https://medium.com/analytics-vidhya/semantic-segmentation-in-pspnet-with-implementation-in-keras-4843d05fc025</a></p>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="panoptic.html" class="navigation navigation-prev " aria-label="Previous page: Panoptic Segmentation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../facenet.html" class="navigation navigation-next " aria-label="Next page: FaceNet">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"PSPNet","level":"1.5.3.2","depth":3,"next":{"title":"FaceNet","level":"1.5.4","depth":2,"path":"cv/facenet.md","ref":"cv/facenet.md","articles":[]},"previous":{"title":"Panoptic Segmentation","level":"1.5.3.1","depth":3,"path":"cv/segmentation/panoptic.md","ref":"cv/segmentation/panoptic.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["katex","-search","-lunr","custom-js-css","docsearch","intopic-toc"],"pluginsConfig":{"docsearch":{},"docSearch":{"apiKey":"9b2d0c53eb838616448e652b3caafb42","index":"ztlevi-machine-learning"},"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3","mode":"nested","maxDepth":6,"isCollapsed":true,"isScrollspyActive":true,"visible":true,"label":"Navigation"},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"custom-js-css":{"css":["css/docsearch.css"]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cv/segmentation/PSPNet.md","mtime":"2021-06-06T08:01:39.121Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-06-06T08:02:29.611Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-docsearch/doc-search-lib.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-docsearch/doc-search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/gumshoe.polyfills.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

